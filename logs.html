<script>
// Mobile nav toggle
const menuToggle = document.getElementById('mobile-menu');
const navLinks = document.querySelector('.nav-links');
menuToggle.addEventListener('click', () => navLinks.classList.toggle('active'));

// Only one form visible at a time
function openForm(formId) {
  const forms = ['event-form-section','quota-form-section','inactivity-form-section'];
  forms.forEach(id => document.getElementById(id).style.display = 'none');
  document.getElementById(formId).style.display = 'block';
}

// Event log rank selection
const rankSelect = document.getElementById('rank');
const enlistedFields = document.getElementById('enlisted-fields');
const staffFields = document.getElementById('staff-fields');
rankSelect.addEventListener('change', () => {
  const rank = rankSelect.value;
  if(['Junior Defender','Specialized Defender','Head Defender','Chief Defender'].includes(rank)) {
    enlistedFields.style.display = 'block';
    staffFields.style.display = 'none';
  } else if(['Specialist II','Specialist I','Security Head Specialist'].includes(rank)) {
    enlistedFields.style.display = 'none';
    staffFields.style.display = 'block';
  } else {
    enlistedFields.style.display = 'none';
    staffFields.style.display = 'none';
  }
});

// Drag & Drop for proof
const dropArea = document.getElementById('drop-area');
const fileInput = document.getElementById('proof');
dropArea.addEventListener('click', () => fileInput.click());
dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.style.background = '#111827'; });
dropArea.addEventListener('dragleave', () => { dropArea.style.background = '#1f2937'; });
dropArea.addEventListener('drop', e => {
  e.preventDefault();
  fileInput.files = e.dataTransfer.files;
  dropArea.style.background = '#1f2937';
});

// Discord webhooks
const WEBHOOKS = {
  enlistedLog: "https://discord.com/api/webhooks/1452045051105378354/gvY94WmTZjJM3uC2WfcEyO2AeaOyb9ID3nZ9oQH5Zkd7I8InNHR5vC7wbm9TGIOI32P2",
  officerLog: "https://discord.com/api/webhooks/1452045053127299144/f-WzziIatdS7fmmOlC9ZBQKOQ0pN6bjV--LHzu9V6vVJHxsWpOjAQ0nxpAP7Z0zXELu7",
  quotaCompletion: "https://discord.com/api/webhooks/1452045057493434478/NI-wWs1iJbz4-1JutkkGVBhHGZ3Oiu6Uc-ubW0THRtbJA0KqauQvz2vnreL71OFVYCtY",
  quota: "https://discord.com/api/webhooks/1452045055350276136/SqDR_7WYB8leCbOwbkc3x_ziDPyIt_T2DgRb_42AoQ2pB0Lu8yEGI6xXl-Y53Cnveqp8",
  inactivity: "https://discord.com/api/webhooks/1454333914553253989/m0FxAv3DqCTPUeLUlwaCqmEHydUQXjT0V6ofH5p-49tEhDvquE2FoqgUR2VcaAUIPHcY",
  quotaExcuse: "https://discord.com/api/webhooks/1454333915694108692/_wD3NF-hRDbemH9JIF4Tty0smBZEgZ9pvi3qWZadjTtXs69HFzBFTDvo900M7YV7Wtd0"
};

// Helper to send to Discord
async function sendToDiscord(webhookUrl, content) {
  try {
    const res = await fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content })
    });
    if(res.ok) {
      alert('Submission successful!');
    } else {
      const text = await res.text();
      console.error(text);
      alert('Submission failed.');
    }
  } catch(err) {
    console.error(err);
    alert('Error submitting to Discord.');
  }
}

// Event form
document.getElementById('event-form').addEventListener('submit', e => {
  e.preventDefault();
  const name = document.getElementById('name').value;
  const rank = document.getElementById('rank').value;
  const eventType = document.getElementById('event-type')?.value || '';
  const hostedType = document.getElementById('hosted-type')?.value || '';
  const description = document.getElementById('description').value;
  const proof = document.getElementById('proof').files[0]?.name || 'No proof';

  let webhookUrl = ['Junior Defender','Specialized Defender','Head Defender','Chief Defender'].includes(rank)
    ? WEBHOOKS.enlistedLog
    : WEBHOOKS.officerLog;

  const content = `**Event Log Submitted**\n**Name:** ${name}\n**Rank:** ${rank}\n**Event Type:** ${eventType}\n**Hosted Type:** ${hostedType}\n**Description:** ${description}\n**Proof:** ${proof}`;
  
  sendToDiscord(webhookUrl, content);
  e.target.reset();
});

// Quota form
document.getElementById('quota-form').addEventListener('submit', e => {
  e.preventDefault();
  const name = document.getElementById('quota-name').value;
  const rank = document.getElementById('quota-rank').value;
  const reason = document.getElementById('quota-reason').value;

  const content = `**Quota Excuse Submitted**\n**Name:** ${name}\n**Rank:** ${rank}\n**Reason:** ${reason}`;
  
  sendToDiscord(WEBHOOKS.quotaExcuse, content);
  e.target.reset();
});

// Inactivity form
document.getElementById('inactivity-form').addEventListener('submit', e => {
  e.preventDefault();
  const name = document.getElementById('inactivity-name').value;
  const rank = document.getElementById('inactivity-rank').value;
  const reason = document.getElementById('inactivity-reason').value;
  const endDate = document.getElementById('inactivity-end').value;

  const content = `**Inactivity Notice Submitted**\n**Name:** ${name}\n**Rank:** ${rank}\n**Reason:** ${reason}\n**End Date:** ${endDate}`;
  
  sendToDiscord(WEBHOOKS.inactivity, content);
  e.target.reset();
});
</script>

